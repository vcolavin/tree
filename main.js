(()=>{var s=(r=>(r.person="person",r.tree="tree",r.limb="limb",r.leaf="leaf",r))(s||{});var u,R=new Uint8Array(16);function B(){if(!u&&(u=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!u))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(R)}var v=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function E(t){return typeof t=="string"&&v.test(t)}var T=E;var i=[];for(y=0;y<256;++y)i.push((y+256).toString(16).substr(1));var y;function F(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase();if(!T(n))throw TypeError("Stringified UUID is invalid");return n}var I=F;function S(t,e,n){t=t||{};var o=t.random||(t.rng||B)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){n=n||0;for(var r=0;r<16;++r)e[n+r]=o[r];return e}return I(o)}var f=S;var m;(n=>{n.factory=({position:o})=>({name:"O'Henry",position:o,id:f(),type:"person"}),n.tick=({thing:o})=>typeof o.position!="string"&&Math.random()>.75?{[o.id]:{...o,position:U(o.position)}}:{}})(m||(m={}));var D=[[1,-1],[1,0],[1,1],[0,-1],[0,1],[-1,-1],[-1,0],[-1,1]],U=([t,e,n])=>{let[o,r]=D[Math.floor(Math.random()*D.length)],p=Math.min(9,Math.max(0,t+o)),l=Math.min(9,Math.max(0,e+r));return[p,l,n]};var b=t=>{switch(t.thing.type){case"person":return m.tick(t);default:return{}}};var c=()=>[[],[],[],[],[],[],[],[],[],[]],a=()=>[c(),c(),c(),c(),c(),c(),c(),c(),c(),c()],j=()=>[a(),a(),a(),a(),a(),a(),a(),a(),a(),a()],d=t=>Object.values(t).filter(n=>typeof n.position!="string").reduce((n,o)=>{let[r,p,l]=o.position;return n[l][r][p].push(o.id),n},j()),g=({coords:t,contentDict:e})=>{let n=`${t[0]}x${t[1]}`,o=JSON.stringify(e);localStorage.setItem(n,o)};var L=({block:{contentList:t,contentDict:e},zLevel:n,tickCount:o=0})=>{let p=t[n].map(l=>l.map(C=>{let P=C[o%C.length];return A({thingId:P,contentDict:e})??" "}).join(" "));p.push(`tick: ${o}`),document.getElementById("rendering-space").innerHTML=p.join(`
`)},A=({thingId:t,contentDict:e})=>{if(!!t)switch(e[t]?.type){case"person":return"P";case"tree":return"T";default:return}};var h;(n=>{n.factory=({position:o})=>({type:"leaf",position:o,id:f()}),n.tick=o=>{}})(h||(h={}));var k;(e=>{e.factory=({position:n})=>{let o=f();return{type:"limb",leaves:[h.factory({position:o})],position:n,id:o}}})(k||(k={}));var x;(n=>{n.factory=({position:o})=>{let r=f();return{type:"tree",limbs:[k.factory({position:r})],id:r,position:o}},n.tick=o=>{}})(x||(x={}));var V=({max:t=9,min:e=0}={})=>{let n=Math.floor(Math.random()*(t+1-e)+e),o=Math.floor(Math.random()*(t+1-e)+e);return[n,o,0]},w=({factory:t,n:e,args:n={}})=>{let o=[];for(let r=0;r<e;r++){let p=t({position:V(),...n});o.push(p)}return o},M=()=>{let t={},e=w({factory:x.factory,n:5}),n=w({factory:m.factory,n:3});e.forEach(r=>t[r.id]=r),n.forEach(r=>t[r.id]=r);let o={contentDict:t,contentList:d(t),coords:[0,0]};g(o)};var N=()=>{let t=localStorage.getItem("0x0");t||(M(),t=localStorage.getItem("0x0"));let e=JSON.parse(t),n={coords:[0,0],contentDict:e,contentList:d(e)};O(n)},O=async t=>{let e=0;for(;++e;){let n=Object.values(t.contentDict).map(o=>b({thing:o,block:t}));t.contentDict=n.reduce((o,r)=>({...o,...r}),{...t.contentDict}),t.contentList=d(t.contentDict),g(t),L({block:t,zLevel:0,tickCount:e}),await new Promise(o=>{setTimeout(o,300)})}};window.onload=N;})();
