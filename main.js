(()=>{var x,G=new Uint8Array(16);function D(){if(!x&&(x=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!x))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return x(G)}var M=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function X(t){return typeof t=="string"&&M.test(t)}var E=X;var i=[];for(h=0;h<256;++h)i.push((h+256).toString(16).substr(1));var h;function J(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase();if(!E(n))throw TypeError("Stringified UUID is invalid");return n}var S=J;function Y(t,e,n){t=t||{};var o=t.random||(t.rng||D)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){n=n||0;for(var r=0;r<16;++r)e[n+r]=o[r];return e}return S(o)}var f=Y;var u=t=>typeof t!="string",I=[[1,-1],[1,0],[1,1],[0,-1],[0,1],[-1,-1],[-1,0],[-1,1]],F=([t,e,n])=>{let[o,r]=I[Math.floor(Math.random()*I.length)],s=Math.min(9,Math.max(0,t+o)),p=Math.min(9,Math.max(0,e+r));return[s,p,n]};var R="person",_=({position:t})=>({name:"O'Henry",position:t,id:f(),type:R}),q=({thing:t})=>{if(u(t.position)&&Math.random()>.75)return{[t.id]:{...t,position:F(t.position)}}},K=t=>`it is ${t.name}`,U={type:R,factory:_,tick:q,symbol:"P",describe:K};var j="leaf",Q=({position:t})=>({type:j,position:t,id:f()}),T={type:j,factory:Q},A="limb",W=({position:t})=>{let e=f();return{type:A,leaves:[T.factory({position:e})],position:t,id:e}},b={type:A,factory:W},O="tree",Z=({position:t})=>{let e=f();return{type:O,limbs:[b.factory({position:e})],id:e,position:t}},tt=t=>{},et=t=>`it is a tree with ${t.limbs.length} branches`,P={type:O,tick:tt,factory:Z,symbol:"T",describe:et};var l={[U.type]:U,[T.type]:T,[b.type]:b,[P.type]:P};var a=()=>[[],[],[],[],[],[],[],[],[],[]],c=()=>[a(),a(),a(),a(),a(),a(),a(),a(),a(),a()],ot=()=>[c(),c(),c(),c(),c(),c(),c(),c(),c(),c()],k=t=>Object.values(t).reduce((n,o)=>{if(!u(o.position))return n;let[r,s,p]=o.position;return n[p][r][s].push(o.id),n},ot()),z=({list:t,diff:e,original:n})=>{Object.entries(e).forEach(([o,r])=>{let s=n[o].position;if(u(s)){let[y,B,m]=s,d=t[m][y][B],C=d.indexOf(o);C>-1&&d.splice(C,1)}let p=r.position;if(u(p)){let[y,B,m]=p;t[m][y][B].push(o)}})},L=({coords:t,contentDict:e})=>{let n=`${t[0]}x${t[1]}`,o=JSON.stringify(e);localStorage.setItem(n,o)};var H=({block:{contentList:t,contentDict:e},zLevel:n,tickCount:o=0,cursor:r})=>{let s=t[n],p,y=s.map((m,d)=>m.map((v,$)=>{if($===r[0]&&d===r[1]&&(p=v,o%3===0||(o-1)%3===0))return"X";let N=v[o%v.length];return nt({thingId:N,contentDict:e})??" "}).join(" "));y.push(`tick: ${o}`);let B=p.map(m=>{let d=e[m];return l[d.type]?.describe(d)}).filter(m=>m).join(`
`);document.getElementById("details-sidebar").innerHTML=B,document.getElementById("rendering-space").innerHTML=y.join(`
`)},nt=({thingId:t,contentDict:e})=>{let n=e[t];return l[n?.type]?.symbol};var rt=({max:t=9,min:e=0}={})=>{let n=Math.floor(Math.random()*(t+1-e)+e),o=Math.floor(Math.random()*(t+1-e)+e);return[n,o,0]},V=({factory:t,n:e,args:n={}})=>{let o=[];for(let r=0;r<e;r++){let s=t({position:rt(),...n});o.push(s)}return o},w=()=>{let t={},e=V({factory:l.tree.factory,n:5}),n=V({factory:l.person.factory,n:3});e.forEach(r=>t[r.id]=r),n.forEach(r=>t[r.id]=r);let o={contentDict:t,contentList:k(t),coords:[0,0]};L(o)};var g={cursor:[0,0,0],gameState:"running"},it=()=>{ct();let t=localStorage.getItem("0x0");t||(w(),t=localStorage.getItem("0x0"));let e=JSON.parse(t),n={coords:[0,0],contentDict:e,contentList:k(e)};st(n)},st=async t=>{let e=0;for(;++e;){if(g.gameState==="running"){let n=Object.values(t.contentDict).map(o=>at({thing:o,block:t})).filter(o=>o).reduce((o,r)=>({...o,...r}),{});z({list:t.contentList,diff:n,original:t.contentDict}),t.contentDict={...t.contentDict,...n},L(t)}H({block:t,zLevel:0,tickCount:e,cursor:g.cursor}),await new Promise(n=>{setTimeout(n,333)})}};window.onload=it;var at=({thing:t,block:e})=>l[t.type].tick?.({thing:t,block:e}),ct=()=>{document.getElementById("pause-button").addEventListener("click",t=>{t.target.innerHTML=g.gameState==="running"?"start":"pause",g.gameState=g.gameState==="running"?"paused":"running"}),document.getElementById("reload-button").addEventListener("click",()=>{w()}),document.addEventListener("keydown",({key:t})=>{let{cursor:e}=g;switch(t){case"ArrowLeft":e[0]=Math.max(e[0]-1,0);break;case"ArrowRight":e[0]=Math.min(e[0]+1,9);break;case"ArrowDown":e[1]=Math.min(e[1]+1,9);break;case"ArrowUp":e[1]=Math.max(e[1]-1,0);break}})};})();
