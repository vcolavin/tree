(()=>{var h,$=new Uint8Array(16);function U(){if(!h&&(h=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!h))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h($)}var M=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function G(t){return typeof t=="string"&&M.test(t)}var E=G;var r=[];for(T=0;T<256;++T)r.push((T+256).toString(16).substr(1));var T;function X(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase();if(!E(n))throw TypeError("Stringified UUID is invalid");return n}var F=X;function J(t,e,n){t=t||{};var o=t.random||(t.rng||U)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=o[i];return e}return F(o)}var m=J;var d=t=>typeof t!="string",I=[[1,-1],[1,0],[1,1],[0,-1],[0,1],[-1,-1],[-1,0],[-1,1]],R=([t,e,n])=>{let[o,i]=I[Math.floor(Math.random()*I.length)],c=Math.min(9,Math.max(0,t+o)),p=Math.min(9,Math.max(0,e+i));return[c,p,n]};var S="person",Y=({position:t})=>({name:"O'Henry",position:t,id:m(),type:S}),_=({thing:t})=>d(t.position)&&Math.random()>.75?{[t.id]:{...t,position:R(t.position)}}:{},D={type:S,factory:Y,tick:_,symbol:"P"};var j="leaf",q=({position:t})=>({type:j,position:t,id:m()}),k={type:j,factory:q},A="limb",K=({position:t})=>{let e=m();return{type:A,leaves:[k.factory({position:e})],position:t,id:e}},L={type:A,factory:K},O="tree",Q=({position:t})=>{let e=m();return{type:O,limbs:[L.factory({position:e})],id:e,position:t}},W=t=>{},P={type:O,tick:W,factory:Q,symbol:"T"};var f={[D.type]:D,[k.type]:k,[L.type]:L,[P.type]:P};var s=()=>[[],[],[],[],[],[],[],[],[],[]],a=()=>[s(),s(),s(),s(),s(),s(),s(),s(),s(),s()],Z=()=>[a(),a(),a(),a(),a(),a(),a(),a(),a(),a()],b=t=>Object.values(t).reduce((n,o)=>{if(!d(o.position))return n;let[i,c,p]=o.position;return n[p][i][c].push(o.id),n},Z()),z=({list:t,diff:e,original:n})=>{Object.entries(e).forEach(([o,i])=>{let c=n[o].position;if(d(c)){let[y,u,B]=c,g=t[B][y][u],x=g.indexOf(o);x>-1&&g.splice(x,1)}let p=i.position;if(d(p)){let[y,u,B]=p;t[B][y][u].push(o)}})},C=({coords:t,contentDict:e})=>{let n=`${t[0]}x${t[1]}`,o=JSON.stringify(e);localStorage.setItem(n,o)};var V=({block:{contentList:t,contentDict:e},zLevel:n,tickCount:o=0,cursorPosition:i})=>{let p=t[n].map((y,u)=>y.map((g,x)=>{if(x===i[0]&&u===i[1]&&(o%3===0||(o-1)%3===0))return"X";let N=g[o%g.length];return tt({thingId:N,contentDict:e})??" "}).join(" "));p.push(`tick: ${o}`),document.getElementById("rendering-space").innerHTML=p.join(`
`)},tt=({thingId:t,contentDict:e})=>{let n=e[t];return f[n?.type]?.symbol};var et=({max:t=9,min:e=0}={})=>{let n=Math.floor(Math.random()*(t+1-e)+e),o=Math.floor(Math.random()*(t+1-e)+e);return[n,o,0]},H=({factory:t,n:e,args:n={}})=>{let o=[];for(let i=0;i<e;i++){let c=t({position:et(),...n});o.push(c)}return o},w=()=>{let t={},e=H({factory:f.tree.factory,n:5}),n=H({factory:f.person.factory,n:3});e.forEach(i=>t[i.id]=i),n.forEach(i=>t[i.id]=i);let o={contentDict:t,contentList:b(t),coords:[0,0]};C(o)};var v="running",l=[0,0,0],ot=()=>{document.getElementById("pause-button").addEventListener("click",t=>{t.target.innerHTML=v==="running"?"start":"pause",v=v==="running"?"paused":"running"}),document.getElementById("reload-button").addEventListener("click",()=>{w()}),document.addEventListener("keydown",({key:t})=>{switch(t){case"ArrowLeft":l[0]=Math.max(l[0]-1,0);break;case"ArrowRight":l[0]=Math.min(l[0]+1,9);break;case"ArrowDown":l[1]=Math.min(l[1]+1,9);break;case"ArrowUp":l[1]=Math.max(l[1]-1,0);break}})},nt=()=>{ot();let t=localStorage.getItem("0x0");t||(w(),t=localStorage.getItem("0x0"));let e=JSON.parse(t),n={coords:[0,0],contentDict:e,contentList:b(e)};it(n)},it=async t=>{let e=0;for(;++e;){if(v==="running"){let n=Object.values(t.contentDict).map(o=>rt({thing:o,block:t})).filter(o=>o).reduce((o,i)=>({...o,...i}),{});z({list:t.contentList,diff:n,original:t.contentDict}),t.contentDict={...t.contentDict,...n},C(t)}V({block:t,zLevel:0,tickCount:e,cursorPosition:l}),await new Promise(n=>{setTimeout(n,333)})}};window.onload=nt;var rt=({thing:t,block:e})=>f[t.type].tick?.({thing:t,block:e});})();
